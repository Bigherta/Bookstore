# 书店管理系统需求分析文档

## 1. 业务流图

### 1.1 角色定义

系统包含三类人员：顾客、销售人员、店长。

未登录状态视为“游客”，仅能注册或登录。

### 1.2 业务流程

游客 → 注册账号 → 系统 → 登录 → 成为用户（顾客/销售人员/店长）

顾客：

查询图书（ISBN / 书名 / 作者 / 关键词任意组合）

购买图书（生成销售记录）

销售人员：

所有顾客功能

进货（录入图书信息、更新库存）

修改图书信息

创建用户（权限不高于自身）

店长：

所有销售人员与顾客功能

查询采购记录（按时间顺序）

查询销售记录（按时间顺序）

查询盈利信息（收入、支出、利润）

查看员工操作日志

查看系统整体工作日志

---

## 2. 数据流图

```  
用户输入（input）
    ↓
命令解析模块（Parser）
    ↓
功能执行模块（Statement）
    │
    ├── 用户管理模块（注册/登录/创建用户）
    │       ├── 读取/写入用户文件
    │       └── 维护登录栈（支持嵌套登录）
    │
    ├── 图书管理模块（查询/录入/修改）
    │       ├── 索引检索（ISBN/书名/作者/关键词）
    │       ├── 文件读写（图书信息、库存）
    │       └── 支持组合查询
    │
    ├── 交易管理模块（采购/销售）
    │       ├── 库存更新
    │       ├── 记录采购/销售流水
    │       └── 计算交易金额
    │
    └── 日志管理模块
            ├── 记录员工操作
            ├── 记录系统事件
            └── 支持店长查询
```

---

## 3. 数据字典（Data Dictionary）

| 数据变量名称    | 类型        | 说明                       |        |
| -------------- | ----------- | ------------------------- | ------ |
| user_ID         | string      | 用户名，唯一标识           |        |
| password       | string      | 密码                      |         |
| privilege      | int         | 权限等级：0/1/3/7          |        |
| ISBN           | string(20)  | 图书唯一标识               |        |
| title          | string(60)  | 书名                       |        |
| author         | string(60)  | 作者名称                   |        |
| keywords       | string(≤60) | 关键词                     |        |
| stock          | int         | 库存量                     |        |
| price          | double      | 售价                       |        |
| import_price    | double      | 进货价格                   |        |
| purchase_record | struct      | ISBN、数量、进货价、购入时间 |        |
| sales_record    | struct      | ISBN、数量、售价、交易时间   |        |
| operation_log   | string      | 员工操作日志               |        |
| system_log      | string      | 系统日志                   |        |

---

## 5. 系统功能说明

### 5.1 用户管理模块

#### 5.1.1 注册用户

- 输入：`register <user_ID> <password>`
- 输出：成功 / 失败
- 处理：检查重名 → 写入用户数据

#### 5.1.2 登录系统

- 输入：`login <user_ID> <password>`
- 输出：成功 / 失败
- 处理：验证密码（查找用户名-密码键值对），若成功，则压入登录栈；否则弹出登录失败信息

#### 5.1.3 登出

- 输入：`logout`
- 输出：成功 / 当前无用户
- 处理：弹出登录栈

#### 5.1.4 创建用户（需销售/店长权限）

- 输入：`useradd <user_ID> <password> <privilege>`
- 输出：成功 / 失败
- 处理：写入用户文件

---

### 5.2 图书管理模块

#### 5.2.1 查询图书

- 输入：`<ISBN> <author> <keywords> <title>`的任意组合
- 输出：排序后的图书列表
- 处理：依据条件检索索引

#### 5.2.2 购买图书

- 输入：`buy <ISBN> <quantity>`
- 输出：总价 / 库存不足
- 处理：库存检查 → 更新库存 → 记录销售

#### 5.2.3 进货

- 输入：`import <ISBN> <quantity> <price>`
- 输出：成功 / 失败
- 处理：增加库存 → 记录采购

#### 5.2.4 图书修改 / 录入

- 输入：`select <ISBN>` → `modify ...`
- 输出：成功 / 失败
- 处理：更新字段 / 新书完整录入

---

### 5.3 店长模块

#### 5.3.1 查询采购记录

- 输入：`show_pur <l> <r>`
- 输出：`<l>`到`<r>`时间段内的采购信息，按时间顺序输出

#### 5.3.2 查询销售记录

- 输入：`show_sale <l> <r>`
- 输出：`<l>`到`<r>`时间段内的销售信息，按时间顺序输出

#### 5.3.3 查询盈利

- 输入：`show_finance <l> <r>`
- 输出：`<l>`到`<r>`时间段内的收入、支出以及利润
  
#### 5.3.4 员工报告

- 输入：`report <user_ID>`
- 输出：`<user_ID>`的操作类型与操作对象，按时间顺序输出

#### 5.3.5 系统日志

- 输入：`log`
- 输出：`SystemLog`

---

## 6. 用户交互设计（命令格式）

### 6.1 基础命令

```
register <user_ID> <password>
login <user_IDd> <password>
logout
```

### 6.2 用户管理

```
useradd <user_ID> <password> <privilege>
```

### 6.3 图书管理

```
show
show -ISBN = <string>
show -title = <string>
show -author = <string>
show -keywords = <string>

select <ISBN>
modify -title = <s> -author = <s> -keywords = <s> -price = <p>
```

### 6.4 交易命令

```
buy <ISBN> <quantity>
import <ISBN> <quantity> <price>
```

### 6.5 店长命令

```
show_pur <l> <r>
show_sale <l> <r>
show_finance <l> <r>
report <user_ID>
log
```

---
